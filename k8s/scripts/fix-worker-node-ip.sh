#!/bin/bash

# ì›Œì»¤ ë…¸ë“œ IP ì„¤ì • ìˆ˜ì • ìŠ¤í¬ë¦½íŠ¸

echo "ğŸ”§ ì›Œì»¤ ë…¸ë“œ IP ì„¤ì • ìˆ˜ì •"
echo "================================"
echo ""

WORKER_NODE="bonanza-worker"
PUBLIC_IP="121.88.4.57"

echo "ì›Œì»¤ ë…¸ë“œ: $WORKER_NODE"
echo "ì„¤ì •í•  ê³µì¸ IP: $PUBLIC_IP"
echo ""

echo "âš ï¸  ì£¼ì˜: ì´ ì‘ì—…ì€ ì›Œì»¤ ë…¸ë“œì—ì„œ ì§ì ‘ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤"
echo ""
echo "ì›Œì»¤ ë…¸ë“œì—ì„œ ì‹¤í–‰í•  ëª…ë ¹ì–´:"
echo "================================"
echo ""
echo "1. k3s-agent ì„œë¹„ìŠ¤ ì¤‘ì§€:"
echo "   sudo systemctl stop k3s-agent"
echo ""
echo "2. k3s-agent í™˜ê²½ ë³€ìˆ˜ íŒŒì¼ ìˆ˜ì •:"
echo "   sudo nano /etc/systemd/system/k3s-agent.service.env"
echo ""
echo "   ë˜ëŠ” ë‹¤ìŒ ë‚´ìš© ì¶”ê°€/ìˆ˜ì •:"
echo "   sudo bash -c 'echo \"K3S_NODE_IP=$PUBLIC_IP\" >> /etc/systemd/system/k3s-agent.service.env'"
echo ""
echo "3. k3s-agent í™˜ê²½ ë³€ìˆ˜ íŒŒì¼ í™•ì¸:"
echo "   cat /etc/systemd/system/k3s-agent.service.env"
echo ""
echo "4. k3s-agent ì¬ì‹œì‘:"
echo "   sudo systemctl daemon-reload"
echo "   sudo systemctl start k3s-agent"
echo ""
echo "5. ë…¸ë“œ ì£¼ì†Œ í™•ì¸:"
echo "   kubectl get node $WORKER_NODE -o jsonpath='{.status.addresses}' | jq"
echo ""
echo "================================"
echo "ë˜ëŠ” k3s ì¬ì„¤ì¹˜ (ë…¸ë“œ IP ì§€ì •):"
echo "================================"
echo ""
echo "1. k3s-agent ì œê±°:"
echo "   sudo /usr/local/bin/k3s-agent-uninstall.sh"
echo ""
echo "2. ë…¸ë“œ IP ì§€ì •í•˜ì—¬ ì¬ì„¤ì¹˜ (ë‚´ë¶€ IP ì‚¬ìš©, ì™¸ë¶€ IPëŠ” ë³„ë„ ì§€ì •):"
echo "   export K3S_TOKEN=<í† í°>"
echo "   export K3S_URL=https://121.88.4.53:6443"
echo "   # WSL2ì—ì„œëŠ” ë‚´ë¶€ IPë¥¼ ì‚¬ìš©í•˜ê³ , ì™¸ë¶€ IPëŠ” node-external-ipë¡œ ì§€ì •"
echo "   curl -sfL https://get.k3s.io | K3S_TOKEN=\$K3S_TOKEN K3S_URL=\$K3S_URL INSTALL_K3S_EXEC=\"--with-node-id --node-name bonanza-worker --node-external-ip $PUBLIC_IP\" sh -"
echo ""
echo "   ë˜ëŠ” ë‚´ë¶€ IPë¥¼ ìë™ ê°ì§€í•˜ë„ë¡ (ê¶Œì¥):"
echo "   curl -sfL https://get.k3s.io | K3S_TOKEN=\$K3S_TOKEN K3S_URL=\$K3S_URL INSTALL_K3S_EXEC=\"--with-node-id --node-name bonanza-worker\" sh -"
echo ""
echo "================================"
echo "í˜„ì¬ ë…¸ë“œ ì£¼ì†Œ í™•ì¸:"
echo "================================"
kubectl get node "$WORKER_NODE" -o jsonpath='{.status.addresses[*]}' | tr ' ' '\n' | grep -E "InternalIP|ExternalIP" || echo "   ë…¸ë“œ ì •ë³´ í™•ì¸ ì‹¤íŒ¨"
echo ""

